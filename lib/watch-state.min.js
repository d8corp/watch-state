var watchState=function(t){"use strict";var e={},r=function(){function t(t){this.target=t,this.rendered=!1,this.update()}return t.prototype.update=function(){var t=this;this.clear(this.cleaners,this.rendered),c((function(){return t.destructor()}));var r=e.activeWatcher;e.activeWatcher=this,this.target(this.rendered),e.activeWatcher=r,this.rendered=!0},t.prototype.destructor=function(){this.clear(this.destructors,!1)},t.prototype.clear=function(t,e){if(t)for(var r=0;r<t.length;r++)t[r](e);this.cleaners=void 0,this.destructors=void 0},t.prototype.onDestructor=function(t){this.destructors?this.destructors.push(t):this.destructors=[t]},t.prototype.onUpdate=function(t){this.cleaners?this.cleaners.push(t):this.cleaners=[t]},t.prototype.onClear=function(t){this.onUpdate(t),this.onDestructor(t)},t}();function n(t){return new r(t)}function a(t){return!!e.activeWatcher&&(e.activeWatcher.onDestructor(t),!0)}function c(t){return!!e.activeWatcher&&(e.activeWatcher.onClear(t),!0)}var i=Symbol("state values");function o(t){return i in t||(t[i]={}),t[i]}var u=function(){function t(t){this.target=t,this.watchers=new Set}return Object.defineProperty(t.prototype,"value",{get:function(){var t=this,r=e.activeWatcher,n=this.watchers;return r&&!this.watchers.has(r)&&(n.add(r),c((function(e){e&&n!==t.watchers||n.delete(r)}))),this.target},set:function(t){if(t!==this.target){this.target=t;var r=this.watchers;r.size&&(this.watchers=new Set,e.actionWatchers?r.forEach((function(t){return e.actionWatchers.add(t)})):r.forEach((function(t){return t.update()})))}},enumerable:!1,configurable:!0}),t}();var s=function(){function t(t){this.target=t,this._value=new u,this._watchersCount=0}return Object.defineProperty(t.prototype,"value",{get:function(){var t=this;return a((function(){t._watchersCount--,t._watchersCount||t._watcher.destructor()}))&&this._watchersCount++,this._watchersCount?(this._watcher||h((function(){t._watcher=new r((function(){t._value.value=t.target()}))})),this._value.value):this.target()},enumerable:!1,configurable:!0}),t}();function h(t){var r=e.activeWatcher;e.activeWatcher=void 0;var n=t();return e.activeWatcher=r,n}return t.Computed=s,t.State=u,t.Watch=r,t.action=function t(r,n,a){return"function"==typeof r?function(){if(e.actionWatchers)return r.apply(this,arguments);var t=e.actionWatchers=new Set,n=r.apply(this,arguments);return e.actionWatchers=void 0,t.forEach((function(t){return t.update()})),n}:Object.assign({},a,{value:t(a.value)})},t.computed=function(t,e,r){var n=r.get;return Object.assign({},r,{get:function(){var t=this,r=o(this);return e in r||h((function(){return r[e]=new s(n.bind(t))})),r[e].value}})},t.default=n,t.lock=h,t.onClear=c,t.onDestructor=a,t.onUpdate=function(t){return!!e.activeWatcher&&(e.activeWatcher.onUpdate(t),!0)},t.reset=function(){e.actionWatchers=e.activeWatcher=void 0},t.scope=e,t.state=function(t,e){Object.defineProperty(t,e,{get:function(){var t=o(this);return e in t||(t[e]=new u),t[e].value},set:function(t){var r=o(this);e in r?r[e].value=t:r[e]=new u(t)},enumerable:!0})},t.watch=n,Object.defineProperty(t,"__esModule",{value:!0}),t}({});
