var WatchState=function(e){"use strict";const t={activeWatcher:void 0,eventDeep:0};function s(e){const{activeWatcher:s}=t;s&&(s.children.add(e),s.destructors.add((()=>{s.children.delete(e)})))}const r=[];let i;function n(e){const t=Boolean(r.length);if(r.push(e),!t)for(;i=r.shift();){i.children.forEach((e=>{r.push(e)}));for(const e of i.destructors)i.destructors.delete(e),e();i.destroyed=!0}}const c=[];let a,h,o,d;function u(e){const t=Boolean(c.length);if(c.push(e),!t)for(;a=c.shift();){a.children.forEach(n);for(const e of a.destructors)a.destructors.delete(e),e()}}function l(e,s){const r=t.activeWatcher;t.activeWatcher=e,s(),t.activeWatcher=r}class v{constructor(){this.observers=new Set}get rawValue(){return this.raw}set rawValue(e){this.raw=e}get value(){const{activeWatcher:e}=t;return e&&(this.observers.add(e),e.destructors.add((()=>{this.observers.delete(e)}))),this.raw}}function f(e){if(!e.size)return;const t=e.values().next().value;return e.delete(t),t}const p=new Set,w=new Set;function W(){if(!d){for(d=!0;(h=f(p))||(o=f(w));)h?h.invalid=!0:(u(o),o.update());d=!1}}function b(e){const s=!t.eventDeep&&!w.size&&!p.size,r=[...w];w.clear(),e.forEach((e=>{w.add(e),e instanceof D&&p.add(e)})),r.forEach((e=>w.add(e))),s&&W()}const g=[];let y;function S(e){const t=g.length;if(g.push(e),!t)for(;y=g.shift();)y instanceof D&&(g.push(...y.observers),y.invalid=!0)}class D extends v{get childrenObservers(){return this.children}get childWatchers(){return this.children}get watcher(){return this.reaction}constructor(e,t,r){super(),this.reaction=e,this.invalid=!0,this.updated=!1,this.destroyed=!1,this.isCache=!0,this.destructors=new Set,this.children=new Set,t||s(this),r&&this.forceUpdate()}update(){S(this);const e=[...this.observers];let t;for(;t=e.pop();){if(!(t instanceof D))return this.forceUpdate();e.push(...t.observers)}}forceUpdate(){this.destroyed||(this.invalid=!1,l(this,(()=>{const e=this.reaction(this.updated);this.updated=!0,e!==this.raw&&(this.raw=e,b(this.observers))})))}get value(){return this.invalid&&this.forceUpdate(),this.destroyed?this.raw:super.value}destroy(){n(this)}}function E(e){const{activeWatcher:s}=t;t.activeWatcher=void 0;const r=e();return t.activeWatcher=s,r}return e.Cache=class extends D{},e.Compute=D,e.Observable=v,e.State=class extends v{constructor(e){super(),this.raw=this.initial=e}get value(){return super.value}set value(e){this.raw!==e&&(this.raw=e,this.update())}set(e){this.value=e}reset(){this.value=this.initial}update(){b(this.observers)}},e.Watch=class{get childrenObservers(){return this.children}get childWatchers(){return this.children}get watcher(){return this.reaction}constructor(e,t,r){this.reaction=e,this.destroyed=!1,this.updated=!1,this.destructors=new Set,this.children=new Set,t||s(this),r||this.update()}destroy(){n(this)}update(){this.destroyed||l(this,(()=>{this.reaction(this.updated),this.updated=!0}))}},e.bindObserver=s,e.callEvent=function(e){const s=E((()=>{t.eventDeep++;const s=e();return t.eventDeep--,s}));return t.eventDeep||W(),s},e.clearWatcher=u,e.createEvent=function(e){return function(...s){const r=E((()=>{t.eventDeep++;const r=e.apply(this,s);return t.eventDeep--,r}));return t.eventDeep||W(),r}},e.destroyWatchers=n,e.forceQueueWatchers=W,e.invalidateCache=function(e){S(e)},e.invalidateCompute=S,e.onDestroy=function(e){t.activeWatcher&&t.activeWatcher.destructors.add(e)},e.queueWatchers=b,e.scope=t,e.shiftSet=f,e.unwatch=E,e.watchWithScope=l,Object.defineProperty(e,"__esModule",{value:!0}),e}({});
