var watchState=function(t){"use strict";let s,e;class r{constructor(t,e,r){this.watcher=t,this.ran=!1,!e&&s&&s.onDestroy((()=>this.destroy())),r||this.update()}static get activeWatcher(){return s}run(){const{ran:t}=this;return this.ran=!0,this.watcher(t)}update(){this.destroy();const t=s;s=this,this.run(),s=t}destroy(){const{destructors:t}=this;t&&(this.destructors=void 0,t.forEach((t=>t())))}onDestroy(t){return this.destructors?this.destructors.push(t):this.destructors=[t],this}}class i extends r{constructor(t,s,e){super(t,s,!e)}destroy(){return this.updated=!1,super.destroy()}clear(){var t,s;(null===(s=null===(t=this._state)||void 0===t?void 0:t.watchers)||void 0===s?void 0:s.size)?this.update():this.destroy()}run(){this.value=super.run(),this.updated=!0}get state(){return this._state||(this._state=new h),this._state}get value(){return this.updated||this.update(),this.state.value}set value(t){this.state.value=t}}class a{add(t){let{watchers:s}=this;if(s){if(s.has(t))return;s.add(t)}else s=this.watchers=new Set([t]);t.onDestroy((()=>s.delete(t)))}start(){if(!e){e=this;const{activeWatchers:t}=this;this.activeWatchers=this.watchers,this.watchers=t}}end(){if(e===this){for(const t of this.activeWatchers)t instanceof i&&t.clear();for(const t of this.activeWatchers)t.update();e=void 0}}pipe(t){this.activeWatchers?(this.activeWatchers.add(t),t.onDestroy((()=>this.activeWatchers.delete(t)))):this.activeWatchers=new Set([t])}update(){var t;if(null===(t=this.watchers)||void 0===t?void 0:t.size)if(e)for(const t of this.watchers)e.pipe(t);else this.start(),this.end()}}class h extends a{constructor(t){super(),this.state=t}get value(){const{activeWatcher:t}=r;return t&&this.add(t),this.state}set value(t){t!==this.state&&(this.state=t,this.update())}}return t.Cache=i,t.Event=a,t.State=h,t.Watch=r,Object.defineProperty(t,"__esModule",{value:!0}),t}({});
