var watchstate=function(t){"use strict";var e={};var r=function(){function t(t){this.target=t,this.update()}return t.prototype.update=function(){var t=this;this.clear(),c((function(){return t.destructor()}));var r=e.activewatcher;e.activewatcher=this,this.target(this.rendered),e.activewatcher=r,this.rendered=!0},t.prototype.destructor=function(){var t=this.destructors;if(t){for(var e=0;e<t.length;e++)t[e]();this.destructors=void 0}},t.prototype.clear=function(){var t=this.cleaners;if(t){for(var e=0;e<t.length;e++)t[e]();this.cleaners=void 0}},t.prototype.ondestructor=function(t){this.destructors?this.destructors.push(t):this.destructors=[t]},t.prototype.onupdate=function(t){this.cleaners?this.cleaners.push(t):this.cleaners=[t]},t.prototype.onclear=function(t){this.onupdate(t),this.ondestructor(t)},t}();function n(t){return new r(t)}function a(t){return!!e.activewatcher&&(e.activewatcher.ondestructor(t),!0)}function c(t){return!!e.activewatcher&&(e.activewatcher.onclear(t),!0)}function i(t){var r=e.activewatcher;e.activewatcher=void 0;var n=t();return e.activewatcher=r,n}var o=symbol("state values");function u(t){return o in t||(t[o]={}),t[o]}var s=function(){function t(t){this.target=t,this.watchers=new set}return object.defineproperty(t.prototype,"value",{get:function(){var t=this,r=e.activewatcher;return r&&!this.watchers.has(r)&&(this.watchers.add(r),c((function(){return t.watchers.delete(r)}))),this.target},set:function(t){if(t!==this.target){this.target=t;var r=this.watchers;r.size&&(this.watchers=new set,e.actionwatchers?r.foreach((function(t){return e.actionwatchers.add(t)})):r.foreach((function(t){return t.update()})))}},enumerable:!1,configurable:!0}),t}();var h=function(){function t(t){this.target=t,this._value=new s,this._watcherscount=0}return object.defineproperty(t.prototype,"value",{get:function(){var t=this;return a((function(){t._watcherscount--,t._watcherscount||t._watcher.destructor()}))&&this._watcherscount++,this._watcherscount?(this._watcher||i((function(){t._watcher=new r((function(){t._value.value=t.target()}))})),this._value.value):this.target()},enumerable:!1,configurable:!0}),t}();return t.computed=h,t.state=s,t.watch=r,t.action=function t(r,n,a){return"function"==typeof r?function(){if(e.actionwatchers)return r.apply(this,arguments);var t=e.actionwatchers=new set,n=r.apply(this,arguments);return e.actionwatchers=void 0,t.foreach((function(t){return t.update()})),n}:object.assign({},a,{value:t(a.value)})},t.computed=function(t,e,r){var n=r.get;return object.assign({},r,{get:function(){var t=this,r=u(this);return e in r||i((function(){return r[e]=new h(n.bind(t))})),r[e].value}})},t.default=n,t.lock=i,t.onclear=c,t.ondestructor=a,t.onupdate=function(t){return!!e.activewatcher&&(e.activewatcher.onupdate(t),!0)},t.reset=function(){e.actionwatchers=e.activewatcher=void 0},t.scope=e,t.state=function(t,e){object.defineproperty(t,e,{get:function(){var t=u(this);return e in t||(t[e]=new s),t[e].value},set:function(t){var r=u(this);e in r?r[e].value=t:r[e]=new s(t)},enumerable:!0})},t.watch=n,object.defineproperty(t,"__esmodule",{value:!0}),t}({});
