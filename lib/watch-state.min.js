var watchState=function(t){"use strict";let e,s;class a{constructor(t,s,a){this.watcher=t,this.ran=!1,!s&&e&&e.onDestroy((()=>this.destroy())),a||this.update()}static get activeWatcher(){return e}static set activeWatcher(t){e=t}run(){const{ran:t}=this;return this.ran=!0,this.watcher(t)}update(){this.destroy();const t=e;e=this,this.run(),e=t}destroy(){const{destructors:t}=this;t&&(this.destructors=void 0,t.forEach((t=>t())))}onDestroy(t){return this.destructors?this.destructors.push(t):this.destructors=[t],this}}class i{add(t){let{watchers:e}=this;if(e){if(e.has(t))return;e.add(t)}else e=this.watchers=new Set([t]);t.onDestroy((()=>e.delete(t)))}_start(){if(!s){s=this;const{activeWatchers:t}=this;this.activeWatchers=this.watchers,this.watchers=t}}start(){this._start(),this.activeWatcher=a.activeWatcher,a.activeWatcher=void 0}_end(){var t;if(s===this){if(this.activeWatchers){for(const e of this.activeWatchers)null===(t=e.clear)||void 0===t||t.call(e);for(const t of this.activeWatchers)t.update()}s=void 0}}end(){a.activeWatcher=this.activeWatcher,this._end()}pipe(t){this.activeWatchers?(this.activeWatchers.add(t),t.onDestroy((()=>this.activeWatchers.delete(t)))):this.activeWatchers=new Set([t])}update(){var t;if(null===(t=this.watchers)||void 0===t?void 0:t.size)if(s)for(const t of this.watchers)s.pipe(t);else this._start(),this._end()}}class r extends i{constructor(t){super(),this.state=t}get value(){const{activeWatcher:t}=a;return t&&this.add(t),this.state}set value(t){t!==this.state&&(this.state=t,this.update())}}return t.Cache=class extends a{constructor(t,e,s){super(t,e,!s)}destroy(){return this.updated=!1,super.destroy()}clear(){var t,e;(null===(e=null===(t=this._state)||void 0===t?void 0:t.watchers)||void 0===e?void 0:e.size)?this.update():this.destroy()}run(){this.value=super.run(),this.updated=!0}get state(){return this._state||(this._state=new r),this._state}get value(){return this.updated||this.update(),this.state.value}set value(t){this.state.value=t}},t.Event=i,t.State=r,t.Watch=a,Object.defineProperty(t,"__esModule",{value:!0}),t}({});
